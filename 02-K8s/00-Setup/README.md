# In the following demo will be setting up 3 Node Kubernetes Cluster ( 1 Master & 2 Workers ) 


 

## Now provision three virtual machines with following commands:

```
VM Template - Master, Worker1 & Worker2
OS - Ubuntu 20.04
Size - Standard D2s v3 (2 vcpus, 8 GiB memory)
Network - Same VNet for all the VMs
Port    - 22,80,443

```

## Login to master node & clone the repo after that execute install-kubernetes.sh. 

Note : 

1.	Check your master machines ip address & update the same in install-kubernetes.sh (--apiserver-advertise-address="YourMasterIP")
2.	Please copy the joining token which is generated by the execution script. 

```
vagrant.exe ssh master
sudo su - 
git clone https://github.com/amitvashisttech/docker-k8s-openshift-wallmart-india-12-Feb-2024.git
cd docker-k8s-openshift-wallmart-india-12-Feb-2024/02-K8s/00-Setup
sh install-k8s-master-node.sh

---
Your Kubernetes master has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join 172.31.0.100:6443 --token mr74fn.m4upjko4cfm5uwmz --discovery-token-ca-cert-hash sha256:cb406434a7f06d213eabfce7d6980b3948525d13e1c25b9f061831039bf49f52

---
```
## In order to intract with kubernetes cluster run the following commands
```
root@master:~# mkdir -p $HOME/.kube
root@master:~# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
root@master:~# sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

### To Check the K8s Node Status
```
root@master:~# kubectl get nodes
NAME     STATUS   ROLES           AGE     VERSION
master   Ready    control-plane   4m47s   v1.28.2
root@master:~#
```


## In parallel Login to both the nodes /workers & clone the repo after that execute install-node.sh. 

```
vagrant.exe ssh woker1
sudo su - 
git clone https://github.com/amitvashisttech/docker-k8s-openshift-wallmart-india-12-Feb-2024.git
cd docker-k8s-openshift-wallmart-india-12-Feb-2024/02-K8s/00-Setup
sh install-k8s-worker-node.sh
```

## Now apply the joining token on both the workers
```
kubeadm join 172.31.0.100:6443 --token mr74fn.m4upjko4cfm5uwmz --discovery-token-ca-cert-hash sha256:cb406434a7f06d213eabfce7d6980b3948525d13e1c25b9f061831039bf49f52
```

## Let check the kubernetes cluster nodes status & details
```
root@master:~# kubectl get nodes
NAME      STATUS   ROLES           AGE   VERSION
master    Ready    control-plane   11m   v1.28.2
worker1   Ready    <none>          56s   v1.28.2
worker2   Ready    <none>          44s   v1.28.2
root@master:~#

root@master:~# kubectl get nodes -o wide
NAME      STATUS   ROLES           AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
master    Ready    control-plane   12m   v1.28.2   172.31.0.100   <none>        Ubuntu 20.04.6 LTS   5.4.0-171-generic   cri-o://1.23.5
worker1   Ready    <none>          86s   v1.28.2   172.31.0.101   <none>        Ubuntu 20.04.6 LTS   5.4.0-156-generic   cri-o://1.23.5
worker2   Ready    <none>          74s   v1.28.2   172.31.0.102   <none>        Ubuntu 20.04.6 LTS   5.4.0-156-generic   cri-o://1.23.5
root@master:~#
```


